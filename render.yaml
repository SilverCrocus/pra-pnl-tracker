# Render Blueprint - https://render.com/docs/blueprint-spec

services:
  # Web service for the dashboard
  - type: web
    name: pra-pnl-tracker
    runtime: python
    plan: starter  # $7/month, always-on
    buildCommand: |
      pip install uv
      uv sync
    startCommand: uv run uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: pra-pnl-db
          property: connectionString
      - key: PYTHON_VERSION
        value: "3.11"
    healthCheckPath: /api/health
    autoDeploy: true

databases:
  # PostgreSQL database
  - name: pra-pnl-db
    plan: starter  # $7/month
    databaseName: pra_pnl
    user: pra_user

# Cron job to run daily pipeline
# Note: Render cron jobs hit an endpoint, so we use the /api/run-pipeline route
# Schedule: 5:00 AM UTC = 4:00 PM AEDT (during daylight saving)
#           5:00 AM UTC = 3:00 PM AEST (outside daylight saving)
# Adjust as needed for your timezone
